import argparse
from modules import xss_scanner, sqli_scanner, csrf_scanner, clickjacking_scanner
from reports import report_generator
from db.database import init_db, save_scan_results


def main():
    parser = argparse.ArgumentParser(description='Web Vulnerability Scanner')
    parser.add_argument('--url', type=str, required=True, help='Target URL to scan')
    parser.add_argument('--scan-type', type=str, required=True,
                        help='Types of scans to perform: xss,sqli,csrf,clickjacking')
    parser.add_argument('--output', type=str, help='Output file for the report')

    args = parser.parse_args()
    url = args.url
    scan_types = args.scan_type.split(',')
    output_file = args.output

    init_db()  # Initialize the database

    results = []

    if 'xss' in scan_types:
        results.append(xss_scanner.scan_xss(url))

    if 'sqli' in scan_types:q
        results.append(sqli_scanner.scan_sqli(url))

    if 'csrf' in scan_types:
        results.append(csrf_scanner.scan_csrf(url))

    if 'clickjacking' in scan_types:
        results.append(clickjacking_scanner.scan_clickjacking(url))

    save_scan_results(url, results)  # Save results to the database
    report_generator.generate_report(results, output_file)  # Generate report


if __name__ == "__main__":
    main()
