import subprocess
from config import SQLMAP_PATH


def scan_sqli(url):
    print(f"Scanning for SQL Injection vulnerabilities on {url}")
    vulnerabilities = []

    result = subprocess.run([SQLMAP_PATH, '-u', url, '--batch', '--output-dir=/tmp/sqlmap'], stdout=subprocess.PIPE)
    output = result.stdout.decode()

    if "identified" in output.lower():
        vulnerabilities.append({
            'type': 'SQL Injection',
            'severity': 'Critical',
            'description': 'SQL Injection vulnerability detected.'
        })

    return {'vulnerabilities': vulnerabilities, 'duration': 15}
